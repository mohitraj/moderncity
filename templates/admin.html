{% extends 'layout.html' %}
{% block content %}
<div class="card mb-3">
  <div class="card-body">
    <h5 class="card-title">Admin Panel â€” Create User</h5>

    {# Only show create-user form to builtin admin or role 'admin' #}
    {% if session.username == 'admin' or session.role == 'admin' %}
    <form method="post" class="form-inline">
      <div class="form-group mr-2">
        <input name="username" class="form-control form-control-sm" placeholder="username" required>
      </div>
      <div class="form-group mr-2">
        <input name="password" type="password" class="form-control form-control-sm" placeholder="password" required>
      </div>
      <div class="form-group mr-2">
        <select name="role" class="form-control form-control-sm">
          {% for value, label in roles %}
            <option value="{{ value }}">{{ label }}</option>
          {% endfor %}
        </select>
      </div>
      <button class="btn btn-sm btn-primary">Create User</button>
    </form>
    {% else %}
      <div class="alert alert-info mb-0">
        Only admin users can create new accounts.
      </div>
    {% endif %}

  </div>
</div>

<div class="card">
  <div class="card-body">
    <h5 class="card-title">Existing Users</h5>
    <table class="table table-sm table-bordered">
      <thead class="thead-light">
        <tr>
          <th>Username</th>
          <th>Role</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for u in users %}
        <tr>
          <td>{{ u.username }}</td>
          <td>
            {% if u.role == 'admin' %}
              <span class="badge badge-danger">Admin</span>
            {% elif u.role == 'maintenance' %}
              <span class="badge badge-info">Maintenance</span>
            {% elif u.role == 'expenditure' %}
              <span class="badge badge-warning">Expenditure</span>
            {% else %}
              <span class="badge badge-secondary">{{ u.role }}</span>
            {% endif %}
          </td>
          <td>
            {% if session.username == 'admin' or session.role == 'admin' %}
              <a href="{{ url_for('delete_user', user_id=u.id) }}"
                 class="btn btn-sm btn-outline-danger"
                 onclick="return confirm('Delete user?')">Delete</a>
            {% else %}
              <small class="text-muted">Admin only</small>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
